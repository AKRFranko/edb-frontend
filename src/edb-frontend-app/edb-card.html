<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="edb-card">
  <template>
    <style>
      :host{
        display:block;
        width:100%;
        height:100%;
        
      }
      
     #card{
       display:block;
       width:100%;
       height:100%;
       position:relative;
       /*padding-top:60%;*/
       @apply(--layout-vertical);
       /*@apply(--layout-justified);*/
       @apply(--edb-font-body);
     }
     
     .card-header{
       position:relative;
       top:0;
       left:0;
       width:100%;
       height:0;
       padding-top:60%;
     }
     
     .card-header iron-image{
       position:absolute;
       top:0;
       left:0;
       width:100%;
       height:100%;
       opacity:1;
       transition: opacity 0.33s;

     }
     .card-header iron-image[invisible] {
       opacity: 0;
     }
     
     .card-title{
       @apply(--edb-font-title);
       line-height:1.2;
       white-space:nowrap;
       text-overflow:ellipsis;
       
       overflow:hidden;
     }
     .card-subtitle{
       @apply(--edb-font-subtitle);
       line-height:1.2;
     }
     .card-subtitle:before{
       content:'_ ';
     }
     .card-body{
       box-sizing:border-box;
       padding:10px 20px;
       @apply(--layout-horizontal);
     }
     .card-content{
       /*@apply(--layout-flex);*/
       /*@apply(--layout-vertical);*/
       /*@apply(--layout-start-justified);*/
      width:100%;
      padding-right:20px;
      max-height:40%;
      overflow:hidden;
      
     }
     :host.square #card{
       /*height:160%;*/
     }
     :host.square .card-header{
       padding-top:100%;
     }
     :host.square .card-content{
       /*height:60%;*/
     }
     .card-icon{
       @apply(--layout-vertical);
       @apply(--layout-center);
       margin-right:-20px;
       
     }
     .card-icon iron-icon{
       display:inline-block;
       top:50%;
       margin-top:-20px;
       width:40px;
       height:40px;
     }
      
    </style>
    
    <div id="card">
      <div class="card-header" style$="background-color:{{bgColor}}" >
        <iron-image id="cardImage" preload sizing="cover" invisible$="{{invisible}}" src="{{image}}"></iron-image>
      </div>
      <div class="card-body">
        <div class="card-content">
          <div hidden$="{{!title}}" class="card-title">{{title}}</div>
          <div hidden$="{{!subtitle}}" class="card-subtitle">{{subtitle}}</div>
          <content></content>
        </div>
        <div class="card-icon" hidden$="{{noIcon}}">
          <iron-icon icon="edb:chevron-right"></iron-icon>
        </div>  
      </div>
      
      <paper-ripple></paper-ripple>
    </div>
    
  </template>
  <script>
     
      Polymer({
  
        is: 'edb-card',
  
        properties: {
          title: {
            type: String,
            value: null,
            notify: true
          },
          subtitle: {
            type: String,
            value: null,
            notify: true
          },
          image: {
            type: String,
            value: null,
            notify: true
          },
          layout: {
            type: String,
            value: null,
            notify: true
          },
          noIcon: {
            type: Boolean,
            value: false,
            notify: true
          },
          bgColor: {
            type: String,
            value: '#ff0000',
            notify: true
          },
          invisible: {
            type: Boolean,
            value: true,
            notify: true
          }
        
        },
        
        
        _scrollCheck: function(){
          
          if(this._isInView()){
            this.set('invisible', false);
          }else{
            this.set('invisible', true);
          }
        },
        _isInView: function(){
          
              
              var rect = this.$.cardImage.getBoundingClientRect();
          
              return (
                  rect.top >= 0 &&
                  rect.left >= 0 &&
                  rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
                  rect.right <= (window.innerWidth || document.documentElement.clientWidth)
              );
          
          
        },
        ready: function(){
          window.addEventListener('scroll',function(){
            this.debounce('scrollVisibility', this._scrollCheck.bind(this), 100);
          }.bind(this));
        }
        
     
  
      });
  </script>
</dom-module>