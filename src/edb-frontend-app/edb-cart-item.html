<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="edb-cart-item">
  <template>
    <style>
      :host{
        display:block;
        width:100%;
        height:100%;
        
      }
      
     #cart-item{
       display:block;
       width:100%;

       position:relative;
       /*padding-top:60%;*/
       @apply(--layout-horizontal);
       /*@apply(--layout-justified);*/
       @apply(--edb-font-body);
     }
     
     .cart-item-image{
       position:relative;
       top:0;
       left:0;
       width:150px;
       height:92px;
     }
     
     .cart-item-image iron-image{
       position:absolute;
       top:0;
       left:0;
       width:100%;
       height:100%;
     }
     .cart-item-title{
       @apply(--edb-font-title);
       line-height:1.2;
       white-space:nowrap;
       text-overflow:ellipsis;
       
       overflow:hidden;
     }
     .cart-item-subtitle{
       @apply(--edb-font-subtitle);
       line-height:1.2;
     }
     .cart-item-subtitle:before{
       content:'_ ';
     }
     .cart-item-body{
       box-sizing:border-box;
       padding:10px 20px;
       @apply(--layout-horizontal);
     }
     .cart-item-content{
       /*@apply(--layout-flex);*/
       /*@apply(--layout-vertical);*/
       /*@apply(--layout-start-justified);*/
      width:100%;
      padding-right:20px;
      max-height:40%;
      overflow:hidden;
      
     }
    
    </style>
    
    <div id="cart-item">
      <div class="cart-item-image">
        <iron-image preload fade sizing="cover" src="{{computeImage(item)}}"></iron-image>
      </div>
      <div class="cart-item-attributes">
        <template is="dom-repeat" items="[[item.variation.attributes]]" as="attribute">
          <iron-image preload fade sizing="cover" style="width:46px;height:46px" src="[[computeAttributeImage(attribute,materials)]]"></iron-image>
        </template>
      </div>
      
      <div class="cart-item-body">
        <div class="cart-item-content">
          <div hidden$="{{!title}}" class="cart-item-title">{{title}}</div>
          <div hidden$="{{!subtitle}}" class="cart-item-subtitle">{{subtitle}}</div>
          <content></content>
        </div>
        <div class="cart-item-icon" hidden$="{{noIcon}}">
          <iron-icon icon="edb:chevron-right"></iron-icon>
        </div>  
      </div>
      
      <paper-ripple></paper-ripple>
    </div>
    
  </template>
  <script>
     
      Polymer({
  
        is: 'edb-cart-item',
  
        properties: {
          item: {
            type: Object,
            value: function(){
              return {};
            },
            notify: true
          },
          materials: {
            type: Array,
            value: function(){
              return [];
            },
            notify: true
          }
          
        
        },
        computeAttributeImage: function( attribute, materials ){
          materials.filter( function( m ){ 
            return m.meta.edb_material_number == attribute.option;
          } )
          if(materials.length > 0){
            return materials[0].image.src;
          }
          console.log('computeAttributeImage',attribute, materials);
        },
        computeImage: function( item){
          var productImage = item.product.images[0].src;
          var variationImage = item.variation.image.src;
          return variationImage ? variationImage : productImage;
        }
        
        
     
  
      });
  </script>
</dom-module>