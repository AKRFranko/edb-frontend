<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="edb-cart-item">
  <template>
    <style>
      :host{
        display:block;
        width:100%;
        height:100%;
        
      }
      
     #cart-item{
       display:block;
       width:100%;
       padding:20px 40px;
       position:relative;
       /*padding-top:60%;*/
       @apply(--layout-horizontal);
       /*@apply(--layout-justified);*/
       @apply(--edb-font-body);
     }
     
     .cart-item-image{
       position:relative;
       top:0;
       left:0;
       width:150px;
       height:92px;
     }
     .cart-item-attributes{
       @apply(--layout-vertical-reverse);
     }
     .cart-item-attribute{
       @apply(--layout-horizontal);
     }
     
     .cart-item-image iron-image{
       position:absolute;
       top:0;
       left:0;
       width:100%;
       height:100%;
     }
     .cart-item-title{
       @apply(--edb-font-body);
       font-weight:bold;
       line-height:1.2;

     }
     .cart-item-subtitle{
       @apply(--edb-font-body);
       font-weight:bold;
       line-height:1.2;
     }
     .cart-item-row{
       /*width:100%;*/
       width:300px;
       @apply(--layout-horizontal);
       @apply(--layout-justified);
     }
     
     .cart-item-body{
       box-sizing:border-box;
       padding:10px 10px;
       /*width:100%;*/
       @apply(--layout-vertical);
     }
     .cart-item-content{
       /*@apply(--layout-flex);*/
       @apply(--layout-horizontal);
       /*@apply(--layout-start-justified);*/
      width:100%;
      padding-right:10px;
      max-height:40%;
      overflow:hidden;
      
     }
    
    </style>
    
    <div id="cart-item">
      <div class="cart-item-image">
        <iron-image preload fade sizing="cover" src="{{computeImage(item)}}"></iron-image>
      </div>
      <div class="cart-item-attributes">
        <template is="dom-repeat" items="[[item.variation.attributes]]" as="attribute">
          <div class="cart-item-attribute">
            <iron-image preload fade sizing="cover" style="width:46px;height:46px" src="[[computeAttributeImage(attribute,materials)]]"></iron-image>
            <!--<p>{{attribute.option}}</p>-->
          </div>
        </template>
      </div>
      
      <div class="cart-item-body">
        
        <div class="cart-item-title">[[item.name]]</div>
        <div class="cart-item-subtitle">x[[item.quantity]]</div>
        <div class="cart-item-total">${{computeCartItemTotal(item)}}</div>
        <div class="cart-item-content">
          <content></content>
        </div>
        
      </div>
      
      <paper-ripple></paper-ripple>
    </div>
    
  </template>
  <script>
     
      Polymer({
  
        is: 'edb-cart-item',
  
        properties: {
          item: {
            type: Object,
            value: function(){
              return {};
            },
            notify: true
          },
          materials: {
            type: Array,
            value: function(){
              return [];
            },
            notify: true
          }
          
        
        },
        computeAttributeImage: function( attribute, materials ){
          var found = materials.filter( function( m ){ 
            return m.meta.edb_material_number == attribute.option;
          } )
          if(found.length > 0){
            return found[0].image.src;
          }else{
            return null;
          }
          
        },
        computeCartItemPrice: function( item ){
          return EDB.Checkout.getPrice( item.product.id, item.variation.attributes );
          
        },
        computeCartItemTotal: function( item ){
          var price = this.computeCartItemPrice( item );
          return item.quantity * price;
        },
        
        computeImage: function( item){
          var productImage = item.product.images[0].src;
          var variationImage = item.variation.image.src;
          return variationImage ? variationImage : productImage;
        }
        
        
     
  
      });
  </script>
</dom-module>