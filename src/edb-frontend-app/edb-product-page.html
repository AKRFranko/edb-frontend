<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="edb-product-page">
  <template>
    <style>
      :host{
        display:block;
        width:100%;
        height:100%;
        
      }
      #page{
        display:block;
        width:100%;
        height:100%;
        @apply(--layout-vertical);
      }
      .page-header{
        position:relative;
        width:100%;
        height:0;
        padding-top:calc(100vh - 140px);
       
      }
      
      .header-inner,.header-split{
        position:absolute;
        width:100%;
        height:100%;
        top:0;left:0;bottom:0;right:0;
        @apply(--layout-vertical);
        /*@apply(--layout-center-center);*/
        z-index:0;
        
      }
      edb-slider{
        background:#000;
      }
      
      .header-split{
        position:relative;
        @apply(--layout-horizontal);
        width:100%;
        height:100%;
        
      }
      edb-slider{
        width:calc(100% - 300px);
        height:100%;
      }
      .page-title{
        @apply(--edb-font-headline);
        color:#fff;
        line-height:1.2;
        white-space:nowrap;
        text-overflow:ellipsis;
        z-index:1;
        overflow:hidden;
      }
      .page-subtitle{
        @apply(--edb-font-subhead);
        color:#fff;
        z-index:1;
      }
      
      #productMenu{
        width:300px;
        color:#000;
        box-sizing:border-box;
        padding:0 40px 0 20px;
        @apply(--layout-vertical);
      }
      
      #productMenu .name{
        @apply(--edb-font-title);
      }
      #productMenu .price{
        @apply(--edb-font-subtitle);
      }
    
      .attribute-label{
        @apply(--edb-font-body);
        margin-top:20px;
        margin-bottom:20px;
      }
      iron-selector{
        width:100%;
        background:#fcfcfc;
        @apply(--layout-horizontal);
        @apply(--layout-wrap);
        box-sizing:border-box;
      }
      iron-selector.slipcover paper-button{
        margin:0;
        padding:0;
        border-radius:0;
        width:calc(100% / 4);
        min-width:calc(100% / 4);
        max-width:calc(100% / 4);
        height:0;
        padding-top:calc(100% / 4);
        position:relative;
        box-sizing:border-box;
      }
      iron-selector.slipcover paper-button iron-image{
        position:absolute;
        width:100%;
        height:100%;
        top:0;
        left:0;
        bottom:0;
        right:0;
        box-sizing:border-box;
        margin:3px;
      }
      .product-quantity{
        @apply(--layout-horizontal);
      }
      .product-options{
        
      }
      
    </style>
    
    <div id="page">
      <div class="page-header">
        <div class="header-inner">
          
        <div class="header-split">
          <edb-slider layout="{{layout}}" slides="{{createProductSlides(product,materials)}}"></edb-slider>
          <div id="productMenu">
            <div class="name">{{product.name}}</div>
            <div class="price">{{formatMoney(product.price)}}</div>
            
            <div class="product-options">
            <template is="dom-repeat" items="{{computeAttributes(product,materials)}}" as="attribute">
              <div class="attribute-label">{{attribute.name}}</div>
              <iron-selector class$="{{attribute.name}}">
              <template is="dom-repeat" items="{{computeAttributeChoices(attribute,product.variations)}}" as="choice">
                <paper-button class$="[[choice.classnames]]" data-value$="[[choice.option]]">
                  <iron-image preload fade sizing="cover" class="choice-icon" hidden$="[[!choice.icon]]" src="[[choice.icon]]"></iron-image>
                  <div class="choice-label" hidden$="[[!choice.label]]">[[choice.label]]</div>
                </paper-button>
              </template>
              </iron-selector>
            </template>
            </div>
            
            <div class="product-quantity">
              <paper-icon-button icon="remove"></paper-icon-button>
              <paper-input no-label-float label="qty" value="{{wantedQty}}"></paper-input>
              <paper-icon-button icon="add"></paper-icon-button>
            </div>
              <!--<template is="dom-repeat" items="{{product.attributes}}" as="productAttribute" index-as="productAttributeindex">-->
              <!--  <h3>{{getVariationAttributeValue(productVariation,productAttribute,productAttributeindex,'name')}}</h3>-->
              <!--  <iron-selector selectable="paper-item" selected="{{selectedVariation}}" attr-for-selected="data-option">-->
              <!--  <template is="dom-repeat" items="{{product.variations}}" as="productVariation">-->
              <!--    <paper-item data-option="{{getVariationAttributeValue(productVariation,productAttribute,productAttributeindex,'option')}}">-->
              <!--      {{getVariationAttributeValue(productVariation,productAttribute,productAttributeindex,'option')}}-->
                    
              <!--    </paper-item>  -->
              <!--</template>-->
              </iron-selector>
              </template>
            
          </div>
        </div>
        </div>
      </div>
      <div class="page-body">
        <div class="page-content">
          <content></content>
        </div>
      </div>
    </div>
    
  </template>
  <script>
     
      Polymer({
  
        is: 'edb-product-page',
  
        properties: {
          
          layout: {
            type: String,
            value: null,
            notify: true
          },
          product: {
            type: Object,
            value: function(){
              return {};
            },
            notify: true
          },
          materials: {
            type: Array,
            value: function(){
              return [];
            },
            notify: true
          },
           
         
        
        },
        observers: ['productChanged(product)'],
        productChanged: function(product){
          console.log('productChanged', product);
          
        },
        getVariationAttributeValue: function( v, attr, idx, prop ){
          return v.attributes[idx][prop];
        },
        
        computeAttributes: function( product,materials ){
          
          return (product.attributes || []).map( function( attr ){
            var foundMaterials = materials.filter( function( m ){
              return m.meta.edb_material_attribute == 'edb_'+attr.name;
            });
            attr.materials = foundMaterials.reduce( function(o,k){
              o[k.meta.edb_material_number] = k;
              return o;
            }, {});
            return attr;
          });
        },
        computeAttributeChoices: function( attr, variations ){
          
          return attr.options.map( function( option ){
            var material = attr.materials[option];
            if(material){
              return { icon: material.image.src, material: material, value: option, classnames: 'material-choice edb_' + attr.name };
            }else{
              return { label: option, value: option, classnames: 'text-choice edb_' + attr.name };
              
            }
          });
          // console.log('computeAttributeChoices', attr, variations);
          // return [];
        },
        createProductSlides: function( item ){
          if(!item) return [];
          if(!item.images) return [];
          // return [];
          return (item.images).map( function( i ){ return { image: i }; });
        },
        formatMoney: function( amount ){
          return EDB.format.money( amount );
        },
        
     
  
      });
  </script>
</dom-module>