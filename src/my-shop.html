<!-- @license Copyright (c) 2016 The Polymer Project Authors. All rights reserved. This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as part of the polymer project is also subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt -->
<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="shared-styles.html">
<dom-module id="my-shop">
  <template>
    <style include="shared-styles">
      *{box-sizing:border-box;}
        :host {
          display: block;
          width:100%;
          @apply --layout;
        
        }
        
      product-page-template,page-template{
        min-width:100%;
      }
        
        .article-grid{
          width:100%;
        }
        
        #repeater{
          display:block;
          width:100%;
        }
        article-template{
          /*min-height:100px;*/
          
          margin-bottom:256px;
          /*margin-bottom:96px;*/
          /*background-color:red;*/
          transition:all .3s ease-out;
          /*transition-delay: .2s;*/
  
        }
        article-template.partially-above,article-template.above-viewport{
          transition-delay: .0s;
          transition:all 0s ease-in;
          margin-bottom:48px;
        }
        article-template.fully-in-viewport{
          
          margin-bottom:48px;
        }
        
        article-template:nth-of-type(odd){
          --article-header-styles:{
            @apply --layout-horizontal;
          }
          
        }
        article-template:nth-of-type(even){
          --article-header-styles:{
            @apply --layout-horizontal-reverse;
          }
          
        }
        iron-pages{
          @apply --layout;
          min-height:100vh;
          min-width:100%; 
          /*background:orange;*/
        }
    </style>
    <app-route route="{{route}}" pattern="/:id" data="{{routeData}}"></app-route>
    
    
    
    
        <iron-pages selected="[[pageType]]" attr-for-selected="name">
          
          <page-template name="listing">
            
            <div slot="page-content">
              <div name="listing">
                <div class="article-grid">
                  <template is="dom-repeat" items="{{products}}" as="product">
                    <a class="article-wrap" href="{{_computeProductLink(product)}}">
                      <article-template title="[[renderAsString(product.name)]]" 
                      image="[[product.image]]"
                      summary="[[renderAsString(product.description)]]">
                      </article-template>
                    </a>
                  </template>
                </div>
              </div>
            </div>
          </page-template>
          
          <product-page-template name="single" product="[[currentProduct]]">
            
          </product-page-template>          
          
        </iron-pages>
        
      
        
    
    
    
  </template>
  <script>
    class MyShop extends EDBHelperMixin(Polymer.Element) {
      static get is() { return 'my-shop'; }
      static get properties(){
        return { 
          pageType: {
            type: String,
            notify:true,
            value: 'listing'
          },
          products: {
            type: Array
            
          },
          currentProduct: {
            type: Array
          },
          currentCategory: {
            type: String
          },
          route: {
            type: Object
          },
          routeData: {
            type: Object
            
          }
          
        }
      }
      static get observers() {
        return [
          '_setPageType(routeData.id)',
          
          
          '_logData("my-shop currentProduct",currentProduct)',
          
          
          // '_routeIdChanged(routeData.id)',
          // '_routeDataChanged(routeData)',
       
        ];
      }
      _logData(type,data){
        console.log(type,data)
      }
      _setPageType(id){
        if(!!id){
          this.pageType = 'single';
        }else{
          this.pageType = 'listing';
          this.currentProduct = null;
        }
        console.log('setPAgeType', this.pageType)
      }
      _computeTitle(prod,cat){
        if(!prod) return cat;
        return prod.id;
        
      }
      
      
      
      _computeProductLink(product){
        if(!product) return;
        return '/shop/' + this.currentCategory + '/' + product.id;
      }
      
      
      // _handleArticleClick(event){
      //   console.log(event.model.feature)
      // }
      // _routeDataChanged(data){
      //   console.log('_routeDataChanged',data)
      // }
      // _routeIdChanged(id){
      //   console.log('_routeIdChanged',id)
      // }
      // logTitle(t){
      //   console.log('logTitle',t);
      //   return 'werwqer';
      // }
      // _computeSlideImageColors( data ){
      //   if(!data) return null;
      //   return data.featured_colors||[];
      // }
      // _computeSlideImageSrc( data ){
      //   if(!data) return null;
      //   // console.log('_computeSlideImageSrc',data)
      //   return data.featured_image;
        
      // }
      // _computeImage( feature ){
        
      //   if(!feature) return null;
      //   return {
      //     colors: feature.featured_colors||[],
      //     src: feature.featured_image
      //   };
      // }
    }

    window.customElements.define(MyShop.is, MyShop);
  </script>
</dom-module>