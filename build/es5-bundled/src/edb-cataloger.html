<html><head><script>EdbCataloger=function(b){return function(c){function d(){babelHelpers.classCallCheck(this,d);var f=babelHelpers.possibleConstructorReturn(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));return f.__delayTasks={},f.__failedTasks={},f}return babelHelpers.inherits(d,c),babelHelpers.createClass(d,[{key:'__commonModuleProxy',value:function(g){return{id:g.id,name:g.name,description:g.description,get image(){return g.images[0]},get images(){var h=g.images;return h.push(h.shift()),h}}}},{key:'_createCompositeModuleProxy',value:function(g){var h=this.compositeModules[g];return Object.assign(this.__commonModuleProxy(h),{get minPrice(){return 0},get maxPrice(){return 0}})}},{key:'_createBaseModuleProxy',value:function(g){var h=this.baseModules[g];return Object.assign(this.__commonModuleProxy(h),{get minPrice(){return parseFloat(h.metaData.edb_base_price)+parseFloat(h.metaData._min_variation_price)},get maxPrice(){return parseFloat(h.metaData.edb_base_price)+parseFloat(h.metaData._max_variation_price)}})}},{key:'_createProduct',value:function(g){var h=!!this.baseModules[g],i=!!this.compositeModules[g];h?this.set('currentProduct',this._createBaseModuleProxy(g)):i&&this.set('currentProduct',this._createCompositeModuleProxy(g)),console.log(this.currentProduct),this._updateSubscribers('currentProduct'),console.log('createProduct',g)}},{key:'_createCatalog',value:function(g){var h=this,i=[];g.itemIds.forEach(function(j){var l=!!h.baseModules[j],m=!!h.compositeModules[j];l?i.push(h._createBaseModuleProxy(j)):m&&i.push(h._createCompositeModuleProxy(j))}),this.set('catalog',i),this._updateSubscribers('catalog')}},{key:'_loadSelectedCategory',value:function(g){var h=this;return g?this.categories[g]?(this._createCatalog(this.categories[g]),Promise.resolve()):new Promise(function(i,j){var l=Date.now();h.addEventListener('categories-changed',function n(){return h.categories[g]?(h.removeEventListener('categories-changed',n),h._createCatalog(h.categories[g]),i()):1e4<Date.now()-l?(h.removeEventListener('categories-changed',n),j('Timeout')):void 0})}):Promise.reject(new TypeError('No category provided'))}},{key:'_onSelectedCategoryChanged',value:function(g){return g?this._loadSelectedCategory(g):void 0}},{key:'_importModuleVariations',value:function(g){var h=this;console.log('_importModuleVariations',g);var i=Promise.resolve();return g.reduce(function(j,l){return j.then(function(){return console.log('next',l),h._fetchVariations(l.id,l.ids)})},i)}},{key:'_fetchVariations',value:function(g){var i=this;return new Promise(function(j,l){i.loading=!0;var m=document.createElement('iron-request'),n=m.send({url:i.$.products.url+'/'+g+'/variations',handleAs:'json',headers:i.headers});n.then(function(){console.log('_fetchVariations','fetched!'),i.loading=!1,j(g)},l)})}},{key:'__wait',value:function(g,h){var i=this;return console.log('wait',g),new Promise(function(j,l){var m=Date.now();i.addEventListener(g,function o(){h.call(i)&&(console.log(g,'passed!'),i.removeEventListener(g,o),j()),1e4<Date.now()-m&&(console.log(g,'timeout!'),i.removeEventListener(g,o),l(new Error('Timeout')))})})}},{key:'_loadSelectedProduct',value:function(g){var h=this;console.log('_loadSelectedProduct',g);var i;if(!g)return Promise.reject(new TypeError('No id provided'));i=~this.productIds.indexOf(g)?Promise.resolve():this.__wait('product-ids-changed',function(){return~h.productIds.indexOf(g)});var j=i.then(function(){console.log('product loaded, loading variations...');var n,l=!!h.compositeModules[g],m=l?h.compositeModules[g]:h.baseModules[g];if(l){var o=m.metaData.edb_group_ids.split(',');n=o.reduce(function(p,q){return p.push({id:q,ids:h.baseModules[q].variations}),p},[])}else n=[{id:g,ids:m.variations}];return h._importModuleVariations(n).then(h._createProduct.bind(h))});return j}},{key:'_onSelectedProductChanged',value:function(g){return g?this.baseModules[g]&&this.compositeModules[g]?this._loadSelectedProduct(g):void 0:void 0}},{key:'prepareForRoute',value:function(g,h,i){var j=this;if(this.preparingForRoute)return Promise.reject('Debounce me?');this.preparingForRoute=!0;var l=null;return l='shop'==g?h&&!i?this.categories[h]?Promise.resolve():this._loadSelectedCategory(h):h&&i?this._loadSelectedProduct(i):Promise.resolve():Promise.reject('Not shop?'),l.then(function(){j.preparingForRoute=!1},function(){j.preparingForRoute=!1})}},{key:'_importBucketModule',value:function(g){this.bucketModules[g.metaData.edb_bucket_slug]=g,this.notifyPath('bucketModules.'+g.id)}},{key:'_importCompositeModule',value:function(g){var h=this,i=g.metaData.edb_group_ids.split(','),j=i.every(function(l){return!!h.baseModules[l]});return j?void(this.compositeModules[g.id]=g,this.notifyPath('compositeModules.'+g.id)):(this.__failedTasks[g.id]||(this.__failedTasks[g.id]=0),this.__delayTasks[g.id]&&this.__delayTasks[g.id].cancel&&(this.__delayTasks[g.id].cancel(),this.__failedTasks[g.id]++),this.__failedTasks[g.id]>(this.products.length||0)+2?console.log('ignoring composite, failed too many times',g):this.__delayTasks[g.id]=Polymer.Async.idlePeriod.run(function(){h._importCompositeModule(g)}))}},{key:'_importBaseModule',value:function(g){this.baseModules[g.id]=g,this.notifyPath('baseModules.'+g.id)}},{key:'_importProductAttributes',value:function(g){var h=this;g.attributes.forEach(function(i){h.attributeMap[g.id]||(h.attributeMap[g.id]={}),h.attributeMap[g.id][i.name]||(h.attributeMap[g.id][i.name]={get name(){return i.name},get options(){return i.options}}),h.bucketModules[i.name]&&Object.defineProperty(h.attributeMap[g.id][i.name],'quantity',{get:function(){}})})}},{key:'_importProductCategories',value:function(g){var h=this;g.categories.forEach(function(i){h.categories[i.slug]||(h.categories[i.slug]=i),h.categories[i.slug].itemIds||(h.categories[i.slug].itemIds=[]),h.categories[i.slug].itemCount||(h.categories[i.slug].itemCount=0),h.categories[i.slug].itemIds.push(''+g.id),h.categories[i.slug].itemCount++,h.notifyPath('categories.'+i.slug)})}},{key:'_importProduct',value:function(g){var h=null;'1'===g.metaData.edb_is_bucket?(h='bucket',this._importBucketModule(g)):g.metaData.edb_group_ids?(h='composite',this._importCompositeModule(g)):(h='base',this._importBaseModule(g)),'bucket'!==h&&(this.push('productIds',''+g.id),this._importProductCategories(g))}},{key:'_onProductsChanged',value:function(g){var h=this;g&&(Array.prototype.forEach.call(g,function(i){for(var j in i.metaData={},i.meta_data)i.metaData[i.meta_data[j].key]=i.meta_data[j].value;h._importProduct(i)}),this._updateSubscribers('currentProduct'),console.log('categories',this.categories),this._updateSubscribers('categories'))}}],[{key:'properties',get:function(){return{baseModules:{type:Object,value:function(){return{}}},compositeModules:{type:Object,value:function(){return{}}},bucketModules:{type:Object,value:function(){return{}}},attributeMap:{type:Object,value:function(){return{}}},productIds:{type:Array,notify:!0,value:function(){return[]}},categories:{type:Object,notify:!0,value:function(){return{}}},selectedCategory:{type:String,value:null,observer:'_onSelectedCategoryChanged'},selectedProduct:{type:String,value:null,observer:'_onSelectedProductChanged'},catalog:{type:Object,value:function(){return{}}}}}}]),d}(b)};</script></head><body></body></html>